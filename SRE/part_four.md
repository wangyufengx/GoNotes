# 第四章 服务质量目标

服务质量指标（SLI）、服务质量目标（SLO）、服务质量协议（SLA）这三项分别是指服务最重要的一些基础指标、这些指标的预期值，以及当指标不符合预期时的应对计划。

### 服务质量术语

#### 指标

- 服务质量指标（SLI）: 服务的某项服务质量的一个具体量化指标。

#####  常见指标

- 请求延迟（处理请求所消耗的时间）：关键SLI
- 错误率（请求处理失败的百分比）
- 系统吞吐量（每秒请求数量）
- 可用性（服务可用时间的百分比）：受重视
- 持久性（数据能够完整保存的时间）：(重要指标）

#### 目标

- 服务质量目标（SLO）： 服务的某个SLI的目标值或者目标范围。

SLO的定义时SLI<=目标值，或者范围下限<=SLI<=范围上限。

#### 协议

- 服务质量协议（SLA）：服务与用户之间的一个明确的或者不明确的协议，描述了在达到或者没达到SLO之后的后果。

### 指标在实践中的应用

#### 运维人员和最终用户各关心什么

我们不应该将监控系统中的所有指标都定义为SLI;只有理解用户对系统的真实需求才能真正决定哪些指标是否有用。一般来说，四五个具有代表性的指标对系统的健康程度的评估和关注就足够了、

##### 常见的服务的相关SLI归类

- 用户可见的服务系统：可用性、延迟、吞吐量、
- 存储系统：延迟、可用性、数据持久性。
- 大数据系统：吞吐量、端到端延迟。
- 所有系统都应该关注：正确性。

#### 指标的收集

- 利用某种监控系统，大部分指标数据都在服务器端被收集。如：Borgmon、Prometheus。
- 利用某种日志分析系统。
- 某些系统可以加入对客户端数据的收集。

#### 汇总

倾向于分析一组数据的百分比分布。

#### 指标的标准化

标准化常见的SLI。

示例：

- 汇总间隔：每分钟汇总一次。
- 汇总范围：集群中的全部任务。
- 度量频率：每10秒一次。
- 包含哪些请求：从黑盒监控任务发来的HTTP GET请求。
- 数据如何获取：通过监控系统获取服务器端信息得到。
- 数据访问延迟：从收到请求到最后一个字节被发出。

### 目标在实践中的应用

从思考用户最关心的方面入手。

#### 目标的定义

SLO应具体指出它们是如何被度量的，以及其有效条件。

对达不到SLO的要求的使用错误预算。

#### 目标的选择

- 不要仅以目前的状态为基础选择目标。
- 保持简单
- 避免绝对值
- SLO越少越好
- 不要追求完美

#### 控制手段

#### SLO可以建立用户预期

##### 策略：

- 留出一定的安全区
- 实际SLO也不要过高
